FROM golang:1.24-bullseye
WORKDIR /src
RUN apt-get update && apt-get install -y --no-install-recommends libpcap-dev
RUN apt-get update && apt-get install -y \
    clang \
    llvm \
    make \
    gcc \
    libelf-dev \
    iproute2 \
    iputils-ping \
    git \
    curl \
    libbpf-dev \
    build-essential \
    pkg-config \
    zlib1g-dev \
    linux-headers-generic \
    m4 \
    gcc-multilib
COPY ./src2/go.* ./
RUN go mod download
COPY ./src2/ ./
RUN go generate
RUN go build -o /dist/main .
RUN rm -rf /src/*
RUN chmod +x /dist/main
CMD ["/dist/main"]
